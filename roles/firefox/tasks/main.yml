---
- name: install
  sudo: yes
  homebrew_cask: name={{item}} state=present
  with_items:
    - firefox
  
- name: |
    HACK: swapping Caskroom/firefox/latest/Firefox.app and /Applications/Firefox.app.
    In order to use the 1Password addon, Firefox.app should exist on the /Application.
  sudo: yes
  shell: >
    creates=/opt/homebrew-cask/Caskroom/firefox/latest/.swapped
    rm -f /Applications/Firefox.app;
    mv /opt/homebrew-cask/Caskroom/firefox/latest/Firefox.app /Applications/Firefox.app;
    ln -s /Applications/Firefox.app /opt/homebrew-cask/Caskroom/firefox/latest/Firefox.app;
    touch /opt/homebrew-cask/Caskroom/firefox/latest/.swapped;
  
- name: install firebrew
  gem: name={{item}} state=present
  with_items:
    - firebrew
  
- name: install add-ons
  firebrew: name='{{item}}' state=present
  with_items:
    - Japanese Language Pack
    - Vimperator
  
- name: get project root
  command: pwd
  register: result
  changed_when: False
  
- name: link .vimperatorrc
  file: >
    state=link
    force=yes
    src={{result.stdout}}/roles/firefox/files/{{item}}
    dest=~/.{{item}}
  with_items:
    - vimperatorrc
